<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Circle with 12 chords through convergence point</title>
  <style>
    body {
      margin: 0;
      background: #0f1420;
      display: grid;
      place-items: center;
      min-height: 100vh;
      color: #e5e7eb;
      font-family: sans-serif;
    }
    .canvas {
      position: relative;
      width: 800px;
      height: 800px;
      border-radius: 50%;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    .background {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }
    svg {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 1;
    }
    .line {
      stroke: #6de39b;
      stroke-width: 2;
    }
    .point {
      fill: #ff5a5f;
      stroke: white;
      stroke-width: 1.5;
      cursor: grab;
    }
    .controls {
      margin-top: 1em;
      text-align: center;
    }
    label {
      margin: 0 0.5em;
    }
    text {
      font-size: 16px;
      fill: white;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="canvas">
    <img class="background" src="circle.png" alt="Circle background" />
    <svg viewBox="0 0 800 800">
      <defs>
        <!-- Arrowhead marker -->
        <marker id="arrow" viewBox="0 0 10 10" refX="10" refY="5"
                markerWidth="6" markerHeight="6" orient="auto">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#6de39b" />
        </marker>
      </defs>
      <g id="lines"></g>
      <circle id="point" class="point" cx="400" cy="400" r="10"></circle>
    </svg>
  </div>

  <div class="controls">
    <label for="startLine">Start Line:</label>
    <select id="startLine"></select>

    <label for="direction">Direction:</label>
    <select id="direction">
      <option value="cw">Clockwise</option>
      <option value="ccw">Counter‑Clockwise</option>
    </select>

    <button id="applyPattern">Apply Pattern</button>
    <button id="resetPattern">Reset</button>
  </div>

  <script>
    const svg = document.querySelector("svg");
    const linesGroup = document.getElementById("lines");
    const point = document.getElementById("point");
    const startLineSelect = document.getElementById("startLine");
    const directionSelect = document.getElementById("direction");
    const applyButton = document.getElementById("applyPattern");
    const resetButton = document.getElementById("resetPattern");

    const center = { x: 400, y: 400 };
    const radius = 350;

    // 12 anchors evenly spaced around circumference (every 30°)
    const anchors = Array.from({ length: 12 }, (_, i) => {
      const angle = (i * 30) * Math.PI / 180;
      return {
        x: center.x + radius * Math.cos(angle),
        y: center.y + radius * Math.sin(angle)
      };
    });
        function render() {
      point.setAttribute("cx", state.point.x);
      point.setAttribute("cy", state.point.y);

      anchors.forEach((A, i) => {
        const B = exitPointOnCircle(A, state.point);
        if (!B) return;
        const line = linesGroup.children[i*2]; // line at even index
        line.setAttribute("x1", A.x);
        line.setAttribute("y1", A.y);
        line.setAttribute("x2", B.x);
        line.setAttribute("y2", B.y);
        line.style.display = state.visibility[i] ? "inline" : "none";
      });
    }

    // Apply Show/Hide pattern
    function applyPattern() {
      const startIndex = parseInt(startLineSelect.value, 10);
      const direction = directionSelect.value;
      const total = anchors.length;

      // Pattern: Show, Show, Hide repeated
      const pattern = [true, true, false];

      let indices = Array.from({length: total}, (_, i) => i);
      if (direction === "ccw") indices.reverse();

      // Rotate so startIndex is first
      while (indices[0] !== startIndex) {
        indices.push(indices.shift());
      }

      // Apply pattern to state.visibility
      indices.forEach((idx, step) => {
        state.visibility[idx] = pattern[step % pattern.length];
      });

      render();
    }

    // Reset all lines to visible
    function resetPattern() {
      state.visibility = Array(12).fill(true);
      render();
    }

    applyButton.addEventListener("click", applyPattern);
    resetButton.addEventListener("click", resetPattern);

    // Dragging logic
    let dragging = false;
    function svgPointFromClient(e) {
      const pt = svg.createSVGPoint();
      pt.x = e.clientX;
      pt.y = e.clientY;
      const ctm = svg.getScreenCTM().inverse();
      const loc = pt.matrixTransform(ctm);
      return { x: loc.x, y: loc.y };
    }
    function clamp(val, min, max) { return Math.max(min, Math.min(max, val)); }

    point.addEventListener("pointerdown", e => {
      dragging = true;
      point.setPointerCapture(e.pointerId);
    });
    svg.addEventListener("pointermove", e => {
      if (!dragging) return;
      const loc = svgPointFromClient(e);
      state.point.x = clamp(loc.x, 0, 800);
      state.point.y = clamp(loc.y, 0, 800);
      render(); // keeps visibility state intact
    });
    svg.addEventListener("pointerup", () => dragging = false);
    svg.addEventListener("pointerleave", () => dragging = false);

    render();
  </script>
</body>
</html>
